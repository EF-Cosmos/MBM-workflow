# UI 面板参考手册 (UI Reference)

本手册详细介绍了 MBM-workflow 插件在 Blender 中的用户界面布局及各参数的功能。

**位置**: 3D 视图 (3D View) > 侧栏 (Sidebar N) > **MBM_workflow** 标签页

## 面板概览

插件界面由以下主要面板组成：
1. **方块 (Block)**
2. **导入 (Import)**
3. **导出 (Export)**
4. **创建存档 (Create Level)**
   - 更多设置 (More Level Settings)
     - 游戏规则 (Game Rules)
     - 玩家能力 (Ability)
5. **编辑 (Edit)**
6. **Mod 设置 (Mod Panel)**
   - 资源包 (Resource Packs)

---

## 1. 方块 (Block)
用于基础方块数据的操作。

- **导入 .json 文件**: 加载自定义的方块模型定义文件。

---

## 2. 导入 (Import)
支持多种格式的地图导入。

### .schem 文件
- **导入 .schem 文件 (主按钮)**: 打开文件选择器导入 `.schem` 文件。
- **导入 Schem 选项**:
  - **按方块状态分离**: 勾选后，不同 ID 的方块将拆分为独立对象（方便材质编辑）。
  - **按区块分离**: 勾选后，按 16x16 chunk 拆分网格（优化大地图性能）。

### .litematic 文件
- **导入 .litematic 文件**: 导入 Litematica 模组格式文件（需 `litemapy` 依赖）。
  - *注意*: 如果依赖缺失，此按钮将显示为灰色。

### 其他导入
- **导入方块**: 导入单个方块模型用于预览。
- **重载失效方块**: 当资源包更新后，点击此按钮重新加载材质丢失的方块。
- **导入 .nbt 文件**: 导入原生 NBT 结构文件。

### 导入 MC 地图 (Import World)
直接从世界存档中提取区域。
- **最小坐标 (Min Coordinates)**: `[X, Y, Z]` 世界坐标起点。
- **最大坐标 (Max Coordinates)**: `[X, Y, Z]` 世界坐标终点。
- **导入世界**: 执行提取操作。

### 优化工具
- **植物摇摆**: 为植物类型方块添加风吹摇摆动画（基于几何节点）。
- **执行优化**: 一键执行网格清理。
- **合并重叠顶点 (Weld)**: 导入时的预处理选项，勾选可减少顶点数。
- **合并重叠面**: **[重要]** 移除方块间不可见的接触面，显著降低面数并修复 Z-fighting。

---

## 3. 导出 (Export)
将 Blender 场景导出回 Minecraft。

- **导出结构**: 将选中的对象导出为 `.schem` 文件。
- **选择世界**: 下拉列表，选择目标 Minecraft 存档（需在 Config 设置存档路径）。
- **结构位置**: 显示导出时的原点坐标。
- **结构大小**: 显示当前选中对象的长宽高（Blender 坐标系）。
- **计算结构大小**: 刷新上方的尺寸数据。
- **导出结构到存档**: 直接将 schem 文件写入选定存档的 `schematics` 文件夹。

---

## 4. 创建存档 (Create Level)
在 Blender 中生成新的 Minecraft 世界存档 (`level.dat`)。

### 基础设置
- **存档名称**: 生成文件夹的名称。
- **出生点坐标**: X, Y, Z。
- **难度**: 和平、简单、普通、困难。
- **游戏模式**: 生存、创造、冒险、旁观。
- **世界类型**: 默认、超平坦等。
- **种子**: 世界生成种子。
- **创建存档**: 生成存档文件。

### 更多设置 (More Level Settings)
- **命令限制**: 修改最大连锁长度等高级参数。
- **环境参数**: 随机刻速度 (Random Tick Speed)、雪堆积高度等。

### 游戏规则 (Game Rules)
包含 40+ 项布尔值开关，如：
- `doDaylightCycle`: 昼夜更替。
- `keepInventory`: 死亡不掉落。
- `mobGriefing`: 生物破坏。

### 玩家能力 (Ability)
设置玩家初始状态：
- 飞行速度/行走速度。
- 最大生命值/幸运值。
- 盔甲值/攻击伤害。

---

## 5. 编辑 (Edit)
地图转换与可视化编辑工具。

### 对照表系统
- **对照表**: 下拉选择当前的颜色映射表。
- **制作颜色-方块字典**: 弹出编辑器，手动指定颜色对应的方块 ID。
- **加载/清除**: 管理对照表文件。

### 方块操作
- **替换方块**: 批量将 A 方块替换为 B 方块（基于 ID）。
- **可视化编辑**:
  - **启动方块笔刷**: 在网格上直接绘制方块（左键绘制，Shift 吸管）。
  - **得到图片平均颜色**: 辅助工具，计算纹理均色。

### 网格转方块
- **生成点云 (ObjToBlocks)**: 转换的第一步，生成顶点数据。
- **转换网格体 (BlockBlender)**: 应用几何节点，将点云实体化为方块。
- **应用顶点色到方块**: 根据顶点颜色自动匹配最近似的方块材质。

---

## 6. Mod 设置 (Mod Panel)
管理游戏版本与资源。

### Mod 列表
- **版本**: 选择目标 Minecraft 版本（用于 PyMCTranslate 转换）。
- **已加载 Mod**: 显示当前识别到的 Mod 列表。
- **添加/删除 Mod**: 导入 `.jar` 文件以支持 Mod 方块。
- **刷新**: 解压并索引新添加的 Mod。

### 资源包 (Resource Packs)
- **路径**: 资源包存放目录。
- **列表**: 调整资源包加载顺序（上层覆盖下层）。
- **刷新**: 应用资源包更改。
